<!DOCTYPE html> 
<html lang="en">   
<head>
    <meta charset="UTF-8">
    <title>Hệ thống điều khiển robot cân bằng </title>
    <link rel="stylesheet" href="style/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script type="text/javascript">
      
      window.onload = function () {
          
          var error = 0;	
          var errorDps = [{x: 1, y: 0}, {x: 2, y: 0}, {x: 3, y: 0}, {x: 4, y: 0}, {x: 5, y: 0},{x: 6, y: 0}, {x: 7, y: 0}, {x: 8, y: 0}, {x: 9, y: 0}, {x: 10, y: 0}];
          var errorChart = new CanvasJS.Chart("errorChartContainer",{
            title :{
              text: "errorData"
            },
            axisX: {						
              title: "Time"
            },
            axisY: {						
              title: "error"
            },
            data: [{
              type: "line",
              dataPoints : errorDps
            }]
          });
          errorChart.render();

          var xVal = errorDps.length + 1;
          var updateInterval = 1000;
    
          var updateChart = function () {
          errorDps.push({x: xVal,y: error});
          
          xVal++;
          if (errorDps.length >  10 )
          {
            errorDps.shift();				
          }

          errorChart.render();		
    
      // update chart after specified time. 
    
          };
          $(document).ready(function(){
                updateTable();
            })
            setInterval(updateTable,1000);
            function updateTable(){
                $.post("readstatus.php",
                function(data){
                    error = parseInt(data[0].error);
                } )
            }
    
    setInterval(function(){updateChart()}, updateInterval); 
    
    }
    </script>
    <script type="text/javascript" src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
</head>
<body>
    <input type="checkbox" id="check">
    <header>
        <label for="check">
            <i class="fas fa-bars" id="sidebar_btn"></i>
        </label>
        <div class="left_area">
            <h3>Hệ thống điều khiển robot cân bằng</h3>
        </div>
    </header>
    <div class="sidebar">
        <a href="info.html"><i class="fa fa-info-circle"></i><span>Thông tin</span></a>
        <a href="watch.html"><i class="fa fa-thermometer-full"></i><span>Giám sát</span></a>
        <a href="control.html"><i class="fa fa-tint"></i><span>Điều khiển</span></a>
    </div>
    <div class="content">
        <div class= "panel">
        <form id="dieukhien" method="get">
            <label>PID </label>
            Kp = <input type="text" step=1  name="kp" id="kp">  <br>
            Ki = <input type="text" step=1  name="ki" id="ki">  <br>
            Kd = <input type="text" step=1  name="kd" id="kd">
            
            <br>
            <input type="submit" value="Kích Hoạt">
        </form>
        </div>
        <br> 
        <div class="speedChart"  id="errorChartContainer" >
        </div>
    </div>
<script>
        $(document).ready(function(){
            $(document).on('submit','#dieukhien', function(){
                $.post('writePID.php',$('#dieukhien').serialize());
                return false;
            });
            updatePID();
        });
    function updatePID(){}
    $.post("readPID.php",
    function(data){
        // doc gia tri tu server gui len
        var p = data[0].kp;
        var i = data[0].ki
        var d = data[0].kd;
        // gan gia cho cac phan tu
        document.getElementById("ki").innerHTML = p;
        document.getElementById("kp").innerHTML = i;
        document.getElementById("kd").innerHTML = d;
    }) 

  
</script>
</body>
</html>